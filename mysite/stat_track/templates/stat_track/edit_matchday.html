{% extends "./base.html" %}
{% load crispy_forms_tags %}

{% block title %}Edit {{matchday}}{% endblock %}

{% block content %}
<div class='container-fluid text-center'>
    <div class='row'>
        <div class='col'>
            <div class='card text-bg-dark'><h2>{{ matchday }}</h2></div>
        </div>
    </div>
    <div class='row mt-3'>

        <div class='col-2'>
            <div class='card text-bg-dark'>
                <div class='card-header'>
                    <h3>Matches</h3>
                </div>
                <div class='card-body'>
                    <div class='list-group'>
                    {% for match in match_list %}
                        <a href='#' class="list-group-item list-group-item-action bg-dark text-white d-flex justify-content-between align-items-center" aria-current="true">
                            {{ match.print_match }}
                            {% if match.winner_team == "blue" %}
                                <span class="badge rounded-pill" style="background-color:#0075ff"> </span>
                            {% elif match.winner_team == "orange" %}
                                <span class="badge rounded-pill" style="background-color:#ff8a00"> </span>
                            {% elif match.winner_team == "colors" %}
                                <span class="badge rounded-pill" style="background-color:#75ff00"> </span>
                            {% endif %}
                        </a>
                    {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class='col-8'>
            <form method="POST" id="matchCreator" data-players-url="{% url 'ajax_load_players' %}">
                <div class='card text-bg-dark'>
                    <div class='card-header'>
                        <h3>Create Match</h3>
                    </div>
                    <div class='card-body'>
                        <div class='container-fluid text-center'>
                            {% csrf_token %}
                            <div class='row'>
                                <div class='col'>
                                    <div class='input-group-text bg-dark border-0 w-100'>
                                        {{ form.team_home }}
                                        {{ form.home_goals }}
                                    </div>
                                </div>
                                <div class='col'>
                                    <div class='input-group-text bg-dark border-0 w-100'>
                                        {{ form.away_goals }}
                                        {{ form.team_away }}
                                    </div>
                                </div>
                            </div>
                            <div class='row'>
                                <div class='col'>
                                    <section id='team-home'>
                                        <div id="player-fields-home"></div>
                                    </section>
                                </div>
                                <div class='col'>
                                    <section method='POST' id='team-away'>
                                        <div id="player-fields-away"></div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class='card-footer'>
                        <button type="submit" name="addMatch" value="addMatch" class="btn btn-outline-success">Add Match</button>
                    </div>
                </div>
            </form>
        </div>

        <div class='col-2'>
            <div class='card text-bg-dark'>
                <div class='card-header'>
                    <h3>Teams</h3>
                </div>
                <div class='card-body'>
                    <div class='list-group'>
                        {% for ticket in ticket_list %}
                            <a href='#' class="list-group-item list-group-item-action bg-dark text-white d-flex justify-content-between align-items-center" aria-current="true">
                                {{ ticket.player }}
                                {% if ticket.team == "blue" %}
                                    <span class="badge rounded-pill" style="background-color:#0075ff"> </span>
                                {% elif ticket.team == "orange" %}
                                    <span class="badge rounded-pill" style="background-color:#ff8a00"> </span>
                                {% elif ticket.team == "colors" %}
                                    <span class="badge rounded-pill" style="background-color:#75ff00"> </span>
                                {% endif %}
                            </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id='matchday_id' data-matchday-id='{{ matchday.id }}'></div>

<script>
    $("#id_team_home").change(function () {
        const url = $("#matchCreator").attr("data-players-url");
        const team = "home";
        const teamHome = $(this).val();
        const matchdayId = document.getElementById("matchday_id").getAttribute("data-matchday-id");

        $.ajax({
            url: url,
            data: {
                'team': team,
                'team_home': teamHome,
                'matchday_id': matchdayId
            },
            success: function (data) {
                $("#player-fields-home").html(data);
            }
        })
    })
</script>
<script>
    $("#id_team_away").change(function () {
        const url = $("#matchCreator").attr("data-players-url");
        const team = "away";
        const teamAway = $(this).val();
        const matchdayId = document.getElementById("matchday_id").getAttribute("data-matchday-id");

        $.ajax({
            url: url,
            data: {
                'team': team,
                'team_away': teamAway,
                'matchday_id': matchdayId
            },
            success: function (data) {
                console.log(data);
                $("#player-fields-away").html(data);
            }
        })
    })
</script>


{% endblock %}